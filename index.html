<h1>バート語の組版</h1>

<svg id="main" height="60mm" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <g fill="none" stroke-opacity=".5">
        <g stroke-linecap="round" stroke-linejoin="round">
            <g stroke-width="15" id="glyphs_main">
            </g>
        </g>
        <g id="boxes" stroke="#540054" stroke-width="15">
        </g>
    </g>
</svg>

<svg height="60mm" version="1.1" viewBox="0 0 660 300" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">
    <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-opacity=".5">
        <path id="baseline" d="m7.5 229.79 645-2e-5" stroke="#ffff00" stroke-width="15" />
        <path id="axis1" d="m7.5 86.293h645" stroke="#800000" stroke-width="15" />
        <path id="consonant_h_00" d="m37.564 86.61v104.89" stroke="#000000" stroke-width="15" />
        <path id="consonant_h_01" transform="matrix(0,-1,-1,0,0,0)"
            d="m-192.84-37.564a37.226 37.5 0 0 1-32.239-18.75 37.226 37.5 0 0 1 0-37.5 37.226 37.5 0 0 1 32.239-18.75"
            stroke="#000000" stroke-width="15" />
        <path id="vowel_e_3-1" d="m37.564 86.226s20.534-41.854 62.61-62.946" stroke="#0000ff" stroke-width="15" />
        <g stroke="#000000" stroke-width="15">
            <path id="consonant_m_00"
                d="m172.5 86.214c-22.5 20.323-30 41.386-29.997 54.822-0.37348 7.3367 4.1622 15.45 10.142 17.077 8.114 1.9618 21.081-4.1317 29.195-6.0934 24.567-9.819 65.659-26.864 65.659 15.406 0 27.926-52.5 44.554-52.5 44.554" />
            <path id="consonant_m_01" d="m195 86.214v143.78" />
            <path id="consonant_s_00" d="m352.56 86.293-1.1e-4 92.756v51.024" />
            <path id="consonant_s_01"
                d="m318.24 223.93c-39.973-7.3139-66.232-98.818-0.65627-98.818 25.951 0 12.042-0.094 34.981 0" />
        </g>
        <g stroke-width="15">
            <path id="vowel_aa"
                d="m352.63 230.11a29.539 28.776 0 018.8871 32.675 29.539 28.776 0 01-29.132 18.362 29.539 28.776 0 01-26.954-21.287"
                stroke="#0000ff" />
            <path id="consonant_n"
                d="m404.34 231.43c48.544-11.531 83.956-88.856 18.292-87.667-18.802 0.34027-24.18 5.4618-40.135 11.175l0.0414-41.458h67.611v-27.191"
                stroke="#000000" />
            <path id="dot_n_to_nr" d="m375 183.24v3a3 3 0 0 0 0-6 3 3 0 0 0 0 6v-3" stroke="#800080" />
        </g>
        <g stroke="#0000ff">
            <path id="vowel_au_00" transform="matrix(0 1 .99997 .0076006 0 0)"
                d="m83.129 450.3a44.279 33.963 0 0 1-38.346-16.982 44.279 33.963 0 0 1 0-33.963 44.279 33.963 0 0 1 38.346-16.982"
                stroke-width="14.999" />
            <path id="vowel_au_01" transform="matrix(0,1,1,0,0,0)"
                d="m86.183 517.39a63.213 33.695 0 0 1-54.744-16.847 63.213 33.695 0 0 1-1e-6 -33.695 63.213 33.695 0 0 1 54.744-16.847"
                stroke-width="15" />
            <path id="vowel_au_02"
                d="m532.46 281.25c-8.7772-11.667-12.883-22.508-14.682-41.438-2.5386-26.709-0.48568-69.52-0.48568-153.47"
                stroke-width="15" />
        </g>
        <g stroke="#000000">
            <path id="consonant_t_00" d="m547.5 86.293v61.506" stroke-width="15" />
            <path id="consonant_t_01" transform="matrix(0,-1,-1,0,0,0)"
                d="m-146.24-547.5a31.247 37.464 0 0 1-27.061-18.732 31.247 37.464 0 0 1 0-37.464 31.247 37.464 0 0 1 27.061-18.732"
                stroke-width="15" />
            <path id="consonant_t_02" d="m622.42 86.293v143.49" stroke-width="15" />
        </g>
        <path id="dot_t_to_tr" d="m540 206.08v3a3 3 0 0 0 0-6 3 3 0 0 0 0 6v-3" stroke="#800080" stroke-width="15" />
        <path id="vowel_u" transform="scale(1,-1)"
            d="m622.42-229.77a34.175 21.716 0 0 1-43.462-10.482 34.175 21.716 0 0 1 13.199-28.324 34.175 21.716 0 0 1 45.437 6.2444"
            stroke="#0000ff" stroke-width="15" />
    </g>
    <g id="layer1" fill="none" stroke-opacity=".5" stroke-width="15">
        <rect id="box1-1" x="22.5" y="7.5" width="105" height="285" rx="0" ry="0" stroke="#540054" />
        <rect id="box1-3" x="262.5" y="7.5" width="105" height="285" rx="0" ry="0" stroke="#540054" />
        <rect id="box1-4" x="367.5" y="7.5" width="165" height="285" rx="0" ry="0" stroke="#ff00ff" />
        <rect id="box1-5" x="532.5" y="7.5" width="105" height="285" rx="0" ry="0" stroke="#540054" />
        <rect id="rect261" x="127.5" y="7.5" width="135" height="285" rx="0" ry="0" stroke="#ab00ab" />
    </g>
</svg>

<script>
    const UNIT = 15;
    const BOX_FULL_HEIGHT = 19 * UNIT;

    const BASE_CONSONANT = {
        "ʔ": {
            paths: ["m82.5 86.299c-0.029 23.393-0.047 66.632-0.047 89.78 0 36.388-36.726 10.288-59.394-3.509 29.44 18.05 36.94 22.946 74.44 57.296"],
            lower_anchor: [97.6, 230.18]
        },
        "g": {
            paths: [
                "m157.48 86.366v76.103s0.96065 34.198-7.4528 47.319c-8.9002 13.879-23.424 20.078-37.5 20.078-11.672 0-22.809-7.4215-31.584-15.118-20.263-17.773-44.122-67.76-44.122-67.76",
                "m157.06 157.4a35.337 26.413 37.381 0 1-25.602 26.76 35.337 26.413 37.381 0 1-37.833-31.721 35.337 26.413 37.381 0 1 23.908-28.18 35.337 26.413 37.381 0 1 38.902 30.461"
            ],
            lower_anchor: [113.97, 230.18],
            dot: [34.5, 119.02]
        },
        "z": {
            paths: [
                "m118.2 142.58h-66.231",
                "m118.2 86.293v92.756l0.14 50.744",
                "m52.1 86.293 1e-4 79.619c-3.3552 37.74-29.583 23.188-31.294-1.9141-0.6721-9.864-0.8694-21.419 31.201-21.419"
            ],
            lower_anchor: [118.2, 230.18]
        },
        "p": {
            paths: [
                "m75 158.06s-33.79-1.0281-47.036-12.965c-4.455-4.0148-5.9136-11.919-5.9136-11.919",
                "m75 158.06s33.79 1.0281 47.036 12.965c4.455 4.0147 5.9136 11.919 5.9136 11.919",
                "m75 86.293-3e-4 143.5",
            ],
            lower_anchor: [75, 230.18],
            dot: [30, 206.08]
        },
        "k": {
            paths: [
                "m53.6 86.214 1e-4 79.619c-3.3552 37.74-29.583 23.188-31.294-1.9141",
                "m120.02 86.214v92.756v50.744",
            ],
            lower_anchor: [120.02, 230.18],
            dot: [25.3, 122.08]
        },
        "w": {
            paths: [
                "m112.2 194.12c-10.482 18.128-28.414 35.693-50.789 35.674-25.32-0.0221-43.265-22.227-46.777-45.555-2.5495-16.936-3.922-33.852 7.0726-46.464 12.798-12.882 28.676-11.864 45.692-11.724 0-11.333-0.1841-26.519 0-39.757"
            ]
        },
        "d": {
            paths: [
                "m97.5 86.293v89.012",
                "m97.5 176.65c0 13.3-7.1475 25.589-18.75 32.239-11.602 6.6497-25.898 6.6497-37.5 0-11.603-6.6497-18.75-18.472-18.75-28.603 0-42.102 48.631-18.047 48.631 32.877 0 4.9428-1.5827 22.626-20.203 22.626"
            ],
            dot: [15, 118.95]
        },
        "c": {
            paths: [
                "m62.4 86.247-30.407 0.04636",
                "m62.4 157.84a41.753 35.796 0 0 0 36.159-17.898 41.753 35.796 0 0 0 0-35.796 41.753 35.796 0 0 0-36.159-17.898",
                "m62.4 157.48a41.753 36.157 0 0 1 41.594 33.006 41.753 36.157 0 0 1-34.344 38.759 41.753 36.157 0 0 1-47.581-26.25"
            ],
            dot: [14.9, 160.63]
        },
        "h": {
            paths: [
                "m22.564 86.61v104.89",
                "m22.564 192.84a37.23 37.5 270 0018.75 32.24 37.23 37.5 270 0037.5 0 37.23 37.5 270 0018.75-32.24"
            ]
        },
        "m": {
            paths: [
                "m52.5 86.214c-22.5 20.323-30 41.386-29.997 54.822-0.37348 7.3367 4.1622 15.45 10.142 17.077 8.114 1.9618 21.081-4.1317 29.195-6.0934 24.567-9.819 65.659-26.864 65.659 15.406 0 27.926-52.5 44.554-52.5 44.554",
                "m75 86.214v143.78"
            ]
        },
        "s": {
            paths: [
                "m97.5 86.293 0 92.756v51.024",
                "m97.5 125.11c-22.94-.09-9.03 0-34.98 0-65.58 0-39.32 91.5.66 98.82"
            ],
            lower_anchor: [97.5, 230.18]
        },
        "n": {
            paths: ["m44.34 231.43c48.544-11.531 83.956-88.856 18.292-87.667-18.802 0.34027-24.18 5.4618-40.135 11.175l0.0414-41.458h67.611v-27.191"],
            dot: [15, 183.24]
        },
        "t": {
            paths: [
                "m22.5 86.293v61.506",
                "m22.5 146.24a37.464 31.247 0 0018.732 27.061 37.464 31.247 0 0037.464 0 37.464 31.247 0 0018.732-27.061",
                "m97.42 86.293v143.49"
            ],
            dot: [15, 206.08],
            lower_anchor: [97.42, 230.18]
        }
    }

    const VOWEL = {
        "á": {
            paths: [
                "m0 0a29.539 28.776 0 0 1 8.8871 32.675 29.539 28.776 0 0 1-29.132 18.362 29.539 28.776 0 0 1-26.954-21.287"
            ],
            anchored: true
        },
        "ai": {
            paths: [
                "m 0 -0.315 c -1.804 -0.065 -3.758 0 -5.563 0 c -47.022 0 -32.261 29.794 -11.386 29.674 c 21.608 -0.125 -15.838 10.909 -32.524 13.611a37.524 28.776 0 0 0 36.929 19.053 37.524 28.776 0 0 0 34.679-21.395"
            ],
            anchored: true
        },
        "e": {
            paths: [
                "m0 86.293s20.534-41.854 62.61-62.946"
            ],
            anchored: false,
            horizontal_displacement: {
                "z": 28.7,
                "d": 30,
                "h": 22.564
            }
        },
        "ú": {
            paths: [
                "m 0 0 c -1.804 -0.065 -3.758 0 -5.563 0 c -47.022 0 -26.556 29.119 -11.386 29.674 c 12.707 0.344 26.021 -0.571 38.734 -0.528 a38.084 28.776 0 0 1-29.773 32.645 38.084 28.776 0 0 1-44.665-20.804"
            ],
            anchored: true
        },
        "ъ": {
            paths: [
                "m0 268.51 37.123-18.117"
            ],
            anchored: false,
            horizontal_displacement: {
                "c": 40.5
            }
        },
        "au": {
            paths: [
                "m0 86.366a44.28 34.3-90 00-16.98-38.48 44.28 34.3-90 00-33.96-0 44.28 34.3-90 00-16.98 38.48",
                "m0 86.366a63.21 33.7 90 0116.85-54.74 63.21 33.7 90 0133.69 0 63.21 33.7 90 0116.85 54.74",
                "m82.46 281.25c-8.7772-11.667-12.883-22.508-14.682-41.438-2.5386-26.709-0.48568-69.52-0.48568-153.47"
            ],
            anchored: false,
            horizontal_displacement: {
                "n": 90
            }
        },
        "u": {
            paths: ["m0 0a34.175 21.716 0 00-43.462 10.482 34.175 21.716 0 0013.199 28.324 34.175 21.716 0 0045.437-6.2444"],
            anchored: true
        }
    }

    function call_consonant(consonant) {
        return BASE_CONSONANT[consonant].paths.map(d => `<path stroke="#000000" d="${d}" />`);
    }

    function call_dot_at([x, y]) {
        return `<path d="m${x} ${y}v3a3 3 0 0 0 0-6 3 3 0 0 0 0 6v-3" stroke="#800080" />`;
    }

    function call_vowel_anchored_at(vowel, [x, y]) {
        if (VOWEL[vowel].anchored) {
            return `<g transform="translate(${x} ${y})">
            ${VOWEL[vowel].paths.map(d => `<path stroke="#0000ff" d="${d}" />`).join("")}
        </g>`;
        }
        else { throw new Error(`Vowel ${vowel} should not be anchored`); }
    }

    function call_vowel_non_anchored(vowel, consonant) {
        if (!VOWEL[vowel].anchored) {
            const x = VOWEL[vowel].horizontal_displacement[consonant];
            return `<g transform="translate(${x ?? 0})">${VOWEL[vowel].paths.map(d => `<path stroke="#0000ff" d="${d}" />`)}</g>`;
        }
        else { throw new Error(`Vowel ${vowel} should be anchored`); }
    }

    function automatic({ consonant, vowel, dotted }) {
        const consonant_paths = call_consonant(consonant);
        const vowel_paths = vowel === 'a' ? [] : VOWEL[vowel].anchored ?
            [call_vowel_anchored_at(vowel, BASE_CONSONANT[consonant].lower_anchor)] : call_vowel_non_anchored(vowel, consonant);

        if (dotted) {
            const dot_coord = BASE_CONSONANT[consonant].dot;
            if (!dot_coord) { throw new Error(`Consonant ${consonant} does not have a dot`); }
            const dot_path = call_dot_at(dot_coord);
            return [...consonant_paths, dot_path, ...vowel_paths];
        }
        else {
            return [...consonant_paths, ...vowel_paths];
        }
    }

    const GLOBAL_GLYPH_TABLE = {
        "pha": {
            width: 135,
            paths: automatic({ consonant: "p", vowel: "a", dotted: true })
        },
        "phá": {
            width: 135,
            paths: automatic({ consonant: "p", vowel: "á", dotted: true })
        },

        "phai": {
            width: 135,
            paths: automatic({ consonant: "p", vowel: "ai", dotted: true })
        },

        "za": {
            width: 135,
            paths: automatic({ consonant: "z", vowel: "a" })
        },
        "zá": {
            width: 135,
            paths: automatic({ consonant: "z", vowel: "á" })
        },
        "ze": {
            width: 135,
            paths: automatic({ consonant: "z", vowel: "e" })
        },
        "zai": {
            width: 135,
            paths: automatic({ consonant: "z", vowel: "ai" })
        },
        "gha": {
            width: 165,
            paths: automatic({ consonant: "g", vowel: "a", dotted: true })
        },
        "ghá": {
            width: 165,
            paths: automatic({ consonant: "g", vowel: "á", dotted: true })
        },

        "ghai": {
            width: 165,
            paths: automatic({ consonant: "g", vowel: "ai", dotted: true })
        },

        "ʔa": {
            width: 105,
            paths: automatic({ consonant: "ʔ", vowel: "a" })
        },

        "ʔá": {
            width: 105,
            paths: automatic({ consonant: "ʔ", vowel: "á" })
        },

        "ʔai": {
            width: 120,
            paths: automatic({ consonant: "ʔ", vowel: "ai" })
        },
        "khú": {
            width: 135,
            paths: automatic({ consonant: "k", vowel: "ú", dotted: true })
        },
        "wa": {
            width: 105,
            paths: automatic({ consonant: "w", vowel: "a" })
        },
        "dhe": {
            width: 105,
            paths: automatic({ consonant: "d", vowel: "e", dotted: true })
        },
        "ṣъ": {
            width: 105,
            paths: automatic({ consonant: "c", vowel: "ъ", dotted: true })
        },
        "he": {
            width: 105,
            paths: automatic({ consonant: "h", vowel: "e" })
        },
        "ma": {
            width: 135,
            paths: automatic({ consonant: "m", vowel: "a" })
        },
        "sá": {
            width: 105,
            paths: automatic({ consonant: "s", vowel: "á" })
        },
        "ṇau": {
            width: 165,
            paths: automatic({ consonant: "n", vowel: "au", dotted: true })
        },
        "ṭu": {
            width: 105,
            paths: automatic({ consonant: "t", vowel: "u", dotted: true })
        }
    };

    const text_to_render = [
        "ze",
        "he",
        "ma",
        "sá",
        "ṇau",
        "ṭu",
        /* "ʔá",
         "ghai",
         "khú",
         "wa",
         "dhe",
         "ṣъ",*/
        /* "pha",
         "phá",
         "phe",
         "phai",
         "za",
         "zá",
         "ze",
         "zai",
         "gha",
         "ghá",
         "ghe",
         "ghai",
         "ʔa",
         "ʔá",
         "ʔe",
         "ʔai",*/
    ];

    const DEBUG_MODE = true;

    // 1 単位分、棒だけが描画される余白を残す
    let box_left_pos = UNIT;

    for (let i = 0; i < text_to_render.length; i++) {
        const current_glyph = GLOBAL_GLYPH_TABLE[text_to_render[i]] ?? (() => { throw new Error(`Unknown glyph: ${text_to_render[i]}`) })();

        if (DEBUG_MODE)
            document.getElementById("boxes").innerHTML += `<rect x="${box_left_pos + UNIT / 2}" y="${UNIT / 2}" width="${current_glyph.width}" height="${BOX_FULL_HEIGHT}" rx="0" ry="0" />`;

        let glyph = "";

        for (let j = 0; j < current_glyph.paths.length; j++) {
            glyph += current_glyph.paths[j];
        }

        document.getElementById("glyphs_main").innerHTML += `<g transform="translate(${box_left_pos})">${glyph}</g>`;

        box_left_pos += current_glyph.width;
    }

    if (DEBUG_MODE)
        document.getElementById("glyphs_main").innerHTML += `<path id="baseline" d="m7.5 229.86h${box_left_pos + UNIT}" stroke="#ffff00" />`;

    document.getElementById("glyphs_main").innerHTML += `<path id="nautuhoma_e" d="m7.5 86.366h${box_left_pos + UNIT}" stroke="#800000" />`;

    document.getElementById("main").setAttribute("viewBox", `0 0 ${box_left_pos + UNIT * 2} ${BOX_FULL_HEIGHT + UNIT}`);
</script>

<h1>作った組み合わせ一覧</h1>

<script>
    const list_of_defined = Object.keys(GLOBAL_GLYPH_TABLE);

    const list_of_consonants = ["ph", "m", "ṣ", "s", "z", "ṭ", "dh", "ṇ", "kh", "gh", "h", "w", "ʔ"];
    const list_of_vowels = ["a", "ъ", "á", "e", "u", "ú", "ai", "au"];

    // draw the HTML table
    document.write("<table border='1' cellpadding='5' cellspacing='0'>");
    document.write("<tr>");
    document.write("<td>↓C ＼ V→</td>");
    for (let i = 0; i < list_of_vowels.length; i++) {
        document.write(`<td>${list_of_vowels[i]}</td>`);
    }
    document.write("</tr>");

    for (let i = 0; i < list_of_consonants.length; i++) {
        document.write("<tr>");
        document.write(`<td>${list_of_consonants[i]}</td>`);
        for (let j = 0; j < list_of_vowels.length; j++) {
            const current_combination = list_of_consonants[i] + list_of_vowels[j];
            document.write(`<td>${list_of_defined.includes(current_combination) ? current_combination : ""}</td>`);
        }
        document.write("</tr>");
    }

</script>