<h1>バート語の組版</h1>

<script src="base_glyphs.js"></script>
<script src="main.js"></script>

<script>
    const GLOBAL_GLYPH_TABLE = {
        "pha": {
            width: 135,
            constituents: ({ consonant: "p", vowel: "a", dotted: true })
        },
        "phá": {
            width: 135,
            constituents: ({ consonant: "p", vowel: "á", dotted: true })
        },

        "phai": {
            width: 135,
            constituents: ({ consonant: "p", vowel: "ai", dotted: true })
        },

        "za": {
            width: 135,
            constituents: ({ consonant: "z", vowel: "a" })
        },
        "zá": {
            width: 135,
            constituents: ({ consonant: "z", vowel: "á" })
        },
        "ze": {
            width: 135,
            constituents: ({ consonant: "z", vowel: "e" })
        },
        "zai": {
            width: 135,
            constituents: ({ consonant: "z", vowel: "ai" })
        },
        "gha": {
            width: 165,
            constituents: ({ consonant: "g", vowel: "a", dotted: true })
        },
        "ghá": {
            width: 165,
            constituents: ({ consonant: "g", vowel: "á", dotted: true })
        },

        "ghai": {
            width: 165,
            constituents: ({ consonant: "g", vowel: "ai", dotted: true })
        },

        "ʔa": {
            width: 105,
            constituents: ({ consonant: "ʔ", vowel: "a" })
        },

        "ʔá": {
            width: 105,
            constituents: ({ consonant: "ʔ", vowel: "á" })
        },

        "ʔai": {
            width: 120,
            constituents: ({ consonant: "ʔ", vowel: "ai" })
        },
        "khú": {
            width: 135,
            constituents: ({ consonant: "k", vowel: "ú", dotted: true })
        },
        "wa": {
            width: 105,
            constituents: ({ consonant: "w", vowel: "a" })
        },
        "dhe": {
            width: 105,
            constituents: ({ consonant: "d", vowel: "e", dotted: true })
        },
        "ṣъ": {
            width: 105,
            constituents: ({ consonant: "c", vowel: "ъ", dotted: true })
        },
        "he": {
            width: 105,
            constituents: ({ consonant: "h", vowel: "e" })
        },
        "ma": {
            width: 135,
            constituents: ({ consonant: "m", vowel: "a" })
        },
        "sá": {
            width: 105,
            constituents: ({ consonant: "s", vowel: "á" })
        },
        "ṇau": {
            width: 165,
            constituents: ({ consonant: "n", vowel: "au", dotted: true })
        },
        "ṭu": {
            width: 105,
            constituents: ({ consonant: "t", vowel: "u", dotted: true })
        },
        "xaQ": {
            width: 135,
            constituents: ({ consonant: "x", vowel: "aQ" })
        },
        "li": {
            width: 165, constituents: ({ consonant: "l", vowel: "i" })
        },
        "ḷi": {
            width: 165, constituents: ({ consonant: "l", vowel: "i", dotted: true })
        },
        "bho": {
            width: 165, constituents: ({ consonant: "b", vowel: "o", dotted: true })
        },
        "ḷo": {
            width: 165, constituents: ({ consonant: "l", vowel: "o", dotted: true })
        },
        "rí": {
            width: 165, constituents: ({ consonant: "r", vowel: "í" })
        },
        "ya": {
            width: 135, constituents: ({ consonant: "j", vowel: "a", dotted: true })
        },

        "sá": {
            width: 105,
            constituents: ({ consonant: "s", vowel: "á" })
        },

        "wá": {
            width: 105,
            constituents: ({ consonant: "w", vowel: "á" })
        },
        "dhá": {
            width: 105,
            constituents: ({ consonant: "d", vowel: "á", dotted: true })
        },
        "ṣá": {
            width: 105,
            constituents: ({ consonant: "c", vowel: "á", dotted: true })
        },
        "há": {
            width: 105,
            constituents: ({ consonant: "h", vowel: "á" })
        },
        "má": {
            width: 135,
            constituents: ({ consonant: "m", vowel: "á" })
        },
        "ṇá": {
            width: 105,
            constituents: ({ consonant: "n", vowel: "á", dotted: true })
        },
        "xá": {
            width: 135,
            constituents: ({ consonant: "x", vowel: "á" })
        },
        "ṭá": {
            width: 135,
            constituents: ({ consonant: "t", vowel: "á", dotted: true })
        },
        "ḷá": {
            width: 105,
            constituents: ({ consonant: "l", vowel: "á", dotted: true })
        },
        "yá": {
            width: 135,
            constituents: ({ consonant: "j", vowel: "á", dotted: true })
        },
        "rá": {
            width: 105,
            constituents: ({ consonant: "r", vowel: "á" })
        },
        "bhá": {
            width: 165,
            constituents: ({ consonant: "b", vowel: "á", dotted: true })
        },
        "khá": {
            width: 135,
            constituents: ({ consonant: "k", vowel: "á", dotted: true })
        },
    };



    function render_word({ syllables_to_render, DEBUG_MODE, svg_id = "main" }) {
        if (!document.getElementById(svg_id)) {
            document.write(`<svg id="${svg_id}" height="30mm" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <g fill="none" stroke-opacity="${DEBUG_MODE ? .5 : 1}">
        <g id="boxes_${svg_id}" stroke="#ffd1ff" stroke-width="${UNIT}">
        </g>
        <g stroke-linecap="round" stroke-linejoin="round">
            <g stroke-width="${UNIT}" id="glyphs_${svg_id}">
            </g>
        </g>
    </g>
    <g id="latin_${svg_id}" font-family="Arial" font-size="${UNIT * 3}" fill="#000000"></g>
</svg>`);
        }
        // 1 単位分、棒だけが描画される余白を残す
        let box_left_pos = UNIT;

        for (let i = 0; i < syllables_to_render.length; i++) {
            const current_glyph = GLOBAL_GLYPH_TABLE[syllables_to_render[i]] ?? (() => { throw new Error(`Unknown glyph: ${syllables_to_render[i]}`) })();

            if (DEBUG_MODE)
                document.getElementById(`boxes_${svg_id}`).innerHTML += `<rect x="${box_left_pos + UNIT / 2}" y="${UNIT / 2}" width="${current_glyph.width}" height="${BOX_FULL_HEIGHT}" rx="0" ry="0" />`;

            let glyph = "";

            const paths = automatic(current_glyph.constituents, DEBUG_MODE);

            for (let j = 0; j < paths.length; j++) {
                glyph += paths[j];
            }

            document.getElementById(`glyphs_${svg_id}`).innerHTML += `<g transform="translate(${box_left_pos})">${glyph}</g>`;

            if (DEBUG_MODE)
                document.getElementById(`latin_${svg_id}`).innerHTML += `<text x="${box_left_pos + UNIT}" y="${UNIT * 4}" " fill="#000000">${syllables_to_render[i]}</text>`;

            box_left_pos += current_glyph.width + GLOBAL_KERNING;
        }

        const axis_width = box_left_pos + UNIT - GLOBAL_KERNING;

        if (DEBUG_MODE)
            document.getElementById(`glyphs_${svg_id}`).innerHTML += `<path id="baseline" d="m7.5 229.86h${axis_width}" stroke="#ffff00" />`;

        document.getElementById(`glyphs_${svg_id}`).innerHTML += `<path id="nautuhoma_e" d="m7.5 86.366h${axis_width}" stroke="${DEBUG_MODE ? "#800000" : "#000000"}" />`;

        document.getElementById(svg_id).setAttribute("viewBox", `0 0 ${box_left_pos + UNIT * 2} ${BOX_FULL_HEIGHT + UNIT}`);
    }

    render_word({
        syllables_to_render: [
            "phá", "bhá", "má",
            "ṣá", "sá", "xá", "zá", "ṭá", "dhá", "ṇá",
            "ḷá", "rá", "khá", "ghá", "há", "yá", "wá", "ʔá",
        ], DEBUG_MODE: true
    });

    document.write("<br>");


    render_word({
        svg_id: "word1",
        syllables_to_render: ["he", "ma", "sá", "ṇau", "ṭu"], DEBUG_MODE: false
    });

    document.write("<br>");

    render_word({
        svg_id: "word2",
        syllables_to_render: ["xaQ", "li", "bho", "ḷo", "rí", "ya"], DEBUG_MODE: false
    });

    document.write("<br>");

    render_word({
        svg_id: "word3",
        syllables_to_render: ["ze", "pha"], DEBUG_MODE: false
    });

    document.write("<br>");


    render_word({
        svg_id: "word4",
        syllables_to_render: ["khú", "wa", "dhe", "ṣъ"], DEBUG_MODE: false
    });

    document.write("<br>");

    render_word({
        svg_id: "word5",
        syllables_to_render: ["ʔá", "ghai"], DEBUG_MODE: false
    });


</script>

<h1>作った組み合わせ一覧</h1>

<script>
    const list_of_defined = Object.keys(GLOBAL_GLYPH_TABLE);

    const list_of_consonants = ["ph", "bh", "m", "ṣ", "s", "z", "ṭ", "dh", "ṇ", "ḷ", "r", "kh", "gh", "h", "w", "ʔ"];
    const list_of_vowels = ["a", "ъ", "á", "e", "i", "í", "u", "ú", "ai", "au"];

    // draw the HTML table
    document.write("<table border='1' cellpadding='5' cellspacing='0'>");
    document.write("<tr>");
    document.write("<td>↓C ＼ V→</td>");
    for (let i = 0; i < list_of_vowels.length; i++) {
        document.write(`<td>${list_of_vowels[i]}</td>`);
    }
    document.write("</tr>");

    for (let i = 0; i < list_of_consonants.length; i++) {
        document.write("<tr>");
        document.write(`<td>${list_of_consonants[i]}</td>`);
        for (let j = 0; j < list_of_vowels.length; j++) {
            const current_combination = list_of_consonants[i] + list_of_vowels[j];
            document.write(`<td>${list_of_defined.includes(current_combination) ? current_combination : ""}</td>`);
        }
        document.write("</tr>");
    }

</script>